<!DOCTYPE html>
<html lang="eg" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">

<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Question</title>
<link rel="icon" type="image/x-icon" href="images/Grouplogo.svg" />
<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" />
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" />
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css"
	rel="stylesheet" />

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script
	src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>

<script
	src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>

</head>

<body class="body1">
	<section class="section4">
		<div class="overla">
			<div class="container-fluid container_contest">
				<div class="nav mt-4 bg_white1">
					<div class="left mx-5 mt-1">
						<img src="images/Grouplogo.svg" alt="logo" class="mb-2" width="60"
							height="70" />
						<p class="logo-text">WEBKORPS</p>
					</div>
				</div>
				<div class="container mx-auto">
					<div class="card_scroll1">
						<div class="d-flex justify-content-center mt-5">

							<div class="question2">
								<h4
									class="text-white text-center  fw-bold  problem_input1 question_size ">
									<a href="questionlistforspecificcontest"
										class="text-decoration-none text-white">Questions</a>
								</h4>
							</div>
							<div class="">
								<div class="answer2">
									<h4
										class="text-white text-center  fw-bold  problem_input1 question_size">
										<a href="viewparticipators"
											class="text-decoration-none text-dark">Participators</a>
									</h4>
								</div>
							</div>
						</div>
						<div class="div_card_white mx-auto mt-5 pt-4">
							<div class="div_card_inner_white mx-auto">

								<div class="row">
									<div class="col-md-1 div_card_inner_blue"></div>
									<div class="col-md-7 second-div">
										<div class="col">
											<input type="hidden" id="contestId" class="contestid" th:value="${contestId}"></input>
											<input type="hidden" id="contestLevel" class="contestlevel" th:value="${contestLevel}"></input>

											<p>
												<label class="fw-bold  text-dark  problem_input1 ">Write
													Problem statement</label>
											</p>
											<input type="text"
												class="aboutQuestion form-control problem_input2 bg-white"
												id="aboutQuestiondata"
												placeholder="Write Problem statement here" /> <small
												class=" error-msgQuestion"></small>
											<div class="pen_img">
												<div class="">
													<img class="" src="images/pen.svg" />
												</div>
											</div>

										</div>
										<div class="col">

											<p>
												<label class="fw-bold  text-dark problem_input1">Constraints</label>
											</p>
											<input type="text"
												class="aboutConstraints form-control problem_input2 bg-white"
												placeholder="Write Constraints here" id="aboutConstraints" />
											<small class="error-msg"></small>
											<div class="pen_img">
												<div class="">
													<img class="" src="images/pen.svg" />
												</div>
											</div>
										</div>
										<div class="col third-div me-5 get_border_bottom">
											<div class="col  ">
												<label class="fw-bold  text-dark  problem_input1">Sample
													Input</label>
													 <textarea 
													class="aboutSampleInput form-control problem_input1 bg-white"
													placeholder="input here" id="aboutSampleInput" ></textarea> <small
													class="error-msgInput"></small>
												<div class="pen_img1">
													<div class="">
														<img class="" src="images/pen.svg" />
													</div>
												</div>
											</div>
											<div class="col">
												<div>
													<label class="fw-bold  text-dark problem_input_label">Sample
														Output </label>
														 <textarea 
														class="aboutSampleOutput f bg-white input_margin1 form-control"
														placeholder="output here" id="aboutSampleOutput" ></textarea> <small
														class="error-msgOutput"></small>
													<div class="pen_img3">
														<div class="">
															<img class="" src="images/pen.svg" />
														</div>
													</div>

												</div>
											</div>
										</div>
										<div
                                            class="text-center text-white fw-bold pt-2 mx-5 d-flex justify-content-end ">

                                            <button class="addQuestionBtn question_btn_level1 btn btn-primary mx-4">Add
                                                Question</button>
                                                <input type="file" id="file-class"  class="question_btn_bulk_question   btn btn-outline-primary mx-4" >
                                          <!--   <button
                                                class="question_btn_bulk_question   btn btn-outline-primary mx-4">bulk
                                                Question
                                            </button> -->

                                        </div>
									</div>

									<div class="col-md-4 border1 ">
										<div class="row row_div1">
											<div class="col third-div">
												<div class="col ">
													<label class="fw-bold text-dark  problem_input1">
														Input</label>
													<textarea
														class="testCaseInput form-control problem_input3 bg-white"
														placeholder="input here"></textarea>
													<small class="validateTestInput" id="validateTestInputOut"></small>
												</div>
												<div class="col ">
													<label
														class="fw-bold text-dark  problem_input1  output_label1"
														style="margin-left: -68px"> Output </label>
													<textarea
														class="testCaseOutput form-control problem_input3 bg-white output_input1"
														placeholder="output here"></textarea>
													<small class="validateTestOutput" id="validateTestInputOut"></small>
												</div>
											</div>
											<div class="col">
												<div class="col mt-5">
													<label class="fw-bold text-dark problem_input1">
														Test case List</label>
													<div class="  third-div1 input_ouput_scroll1 ">
														<div class=" d-flex justify-content-center">
															<div class="mx-5">Input</div>

															<div class="mx-5">Output</div>
														</div>
														<div>
															<ul class="inputOutputList">

															</ul>
														</div>
													</div>
												</div>
												<div class="d-flex justify-content-end add_close_btn">
													<div>
														<button
															class="addMoreIO Add1  text-center text-white fw-bold pt-2 mx-3 btn btn-primary">
															Add</button>
													</div>
													<div>
														<button
															class="close1  text-center text-white fw-bold pt-2 btn btn-primary">
															close</button>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>

							
							<div>
								<div class="question_box row">
								<div class="col-6">
									<h3 class="mx-4 pt-4 fw-bold text-dark">Contest contain following questions : </h3>
									</div>
									<div class="col-6"><a href="#all_question_div7" class="text-decoration-none"><button class="addQuestionBtn question_btn4 btn btn-outline-primary"
                                                onclick="all_question_div7()"> Available Questions </button></a>                                                                            
									</div>
								</div>
								<div class="added_questions overflow-y-scroll ">
									<div th:each="q:${questions}">
										<div th:class="${q.questionId}">
											<div class="added_question_box row mx-4 mt-3">
												<div class="col-8">
													<p class="added_question_box_text">
														<span class="added_question_box_text"
															th:text="${q.question}"></span>
													</p>
												</div>
												<div class="col-3 ">
													<input type="hidden" id="hiddenQid" class="questionid"
														th:value="${q.questionId}"></input>
													<p class="Edit_Question  mx-5">Edit Question</p>
												</div>
												<div class="col-1 mt-3 btn_img_cross"
													th:id="${q.questionId}" onclick="deleteQuestion(this.id)">
													<img src="images/crossbtn.svg" alt="logo" />
												</div>
											</div>
										</div>
									</div>
								</div>

								  <div class="question_box   " id="all_question_div7" style="display:none; height: 450px;" >
                                    <div class="row mb-5">
                                                                                                                                                                                                                                                                                                          
                                        <div class="col-7">
                                            <h3 class="mx-4 pt-4 fw-bold text-dark">Available Questions</h3>
                                        </div>
                                        <div class="col-5">
                                            <div class=" d-flex ">
                                                <div> <select class=" form-select  option-dropdown2 mt-3">
                                                        <option value="All">All</option>
                                                        <option value="Level 1">Level 1</option>
                                                        <option value="Level 2">Level 2</option>
                                                    </select></div>

                                                <div class="text-center text-white fw-bold pt-3 px-3 ">
                                                    <button class="question_btn2 btn btn-primary" id="btn" >Add Question</button>  
                                                </div>
                                                <i class="fa-solid fa-square-xmark  fa-xl  cross_red_available " style="color:red;"  onclick="all_question_div7()"></i>
                                             </div>
                                            </div>
                                     <div class="added_questions_all_question2 overflow-y-scroll ">
											<div class="availableglass" th:each="q:${totalQuestions}">
												<div th:class="${q.questionId}">
													<div class="added_question_box row mx-4 mt-3">
														<div class="col-9">
															<p class="overflow_level1 ">
																<span class="" style="overflow-wrap: anywhere;"
																	th:text="${q.question}"></span>
															</p>
														</div>
														<div class="col-2 ">
															<div>
																<div class=" pt-3 mx-5">
																	<div class="round">
																		<input type="checkbox" th:id="${q.questionId}"
																			name="color" th:value="${q.questionId}" /> <label
																			th:for="${q.questionId}"></label>
																	</div>

																</div>
															</div>
														</div>
														<div class="col-1 mt-3 btn_img_cross"
															th:id="${q.questionId}" onclick="deleteQuestion(this.id)">
															<!-- <img src="images/crossbtn.svg" alt="logo" /> -->
														</div>
													</div>



												</div>
											</div>
										</div>
									</div>

                                </div>
							</div>
							<div class="copyright_text_question">
								<p class="text-center text-dark fw-bold mt-2">
									Copyright@webkorps2021</p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
		crossorigin="anonymous"></script>
	<script>
  //<![CDATA[
        var liId = 1;
        var updatedQuestionId="";
        $(".addMoreIO").on("click", function () {
            var input = $(".testCaseInput").val();
            var output = $(".testCaseOutput").val();
            console.log(input);
            console.log(output);
            var data = '<li class="removeCurrentIOli1 listStyle">';
            data += '<textarea class="form-control textarea_1 bg-white mx-3" readonly="readonly" id="input" name="dataOfIO">' + input + '</textarea><textarea class="form-control textarea_1 bg-white" id="output" readonly="readonly" name="dataOfIO">' + output + '</textarea> <div class="btn_img_cross" id="' + liId + '" onclick="removeCurrentIOli(this.id)" ><img src="images/crossbtn.svg" class=" mx-3 mt-2" alt="cross" height="20px" width="20px" /></div></li>';
            liId++;
            if(($(".testCaseInput").val())&&($(".testCaseOutput").val()))
            $('.inputOutputList').append(data);
            
            var testCaseValue = document.getElementsByName('dataOfIO');
            var numberofElements= parseInt(testCaseValue.length);
            if(numberofElements == 0)
            	{
             
            	}
            else
            	{
            	$(".validateTestInput").html("").removeClass(".validateTestInput")
            	$("#validateTestInputOut").html("").removeClass("#validateTestInputOut")
            	$(".validateTestOutput").html("").removeClass(".validateTestOutput")
            	}
            
            testCaseValue.forEach(element => {
                console.log(element.value);
            });
        
            $('.testCaseInput').val('')
               $('.testCaseOutput').val('')
            
        });
     
       /*  $("#form1").validate({
        	rules:{
        		firstname:true
        	},
        	 messages: {
        		 required :"Please specify your name"
             },

        }) */
        $(".addQuestionBtn").on("click", function () {
            var testCaseList = [];
            var data;
            var SampleTestCaseList = [];
           
            var sampleTestCase;
            var i = 1;
            var id = 1;
            var input, output;
            var contestId = $("#contestId").val();
            var contestLevel = $("#contestLevel").val();
            var testCaseValue = document.getElementsByName('dataOfIO');
            testCaseValue.forEach(element => {
                if (i == 1) {
                    if (element.value != null) {
                        input = element.value;
                        i++;
                    }
                } else if (i == 2) {
                    if (element.value != null) {
                        output = element.value;
                        data = {
                            'id': id,
                            'input': input,
                            'output': output
                        };
                        testCaseList.push(data);
                        id++;
                    }
                    i = 1;
                }
            });
            sampleTestCase = {
                'constraints': $(".aboutConstraints").val(),
                'input': $(".aboutSampleInput").val(),
                'output': $(".aboutSampleOutput").val()
            };
            
            if (!$('.aboutQuestion').val()) {
                $(".error-msgQuestion").html("Question field is required").addClass(".error-msgQuestion")
                return ;
               }else{
               	 $(".error-msgQuestion").html("").removeClass(".error-msgQuestion")
               } 
         
            if (!$('.aboutConstraints').val()) {
             $(".error-msg").html("Constraints field is required").addClass(".error-msg")
             return ;
            }else{
            	 $(".error-msg").html("").removeClass(".error-msg")
            } 
            if (!$('.aboutSampleInput').val()) {
                $(".error-msgInput").html("Input field is required").addClass(".error-msgInput")
                return ;
               }else{
               	 $(".error-msgInput").html("").removeClass(".error-msgInput")
               } 
            if (!$('.aboutSampleOutput').val()) {
                $(".error-msgOutput").html("Output field is required").addClass(".error-msgOutput")
                return ;
               }else{
               	 $(".error-msgOutput").html("").removeClass(".error-msgOutput")
               } 
            var numberofElements= parseInt(testCaseValue.length);
            if(numberofElements == 0)
        	{
        	 if ((!$('.testCaseInput').val()) && (!$('.testCaseOutput').val())) {
                 $("#validateTestInputOut").html("field is required").addClass("#validateTestInputOut")
                 return ;
                }else{
                	
                	 $("#validateTestInputOut").html("").removeClass("#validateTestInputOut")
                } 
        	 
        	 if (!$('.testCaseInput').val()) {
                 $(".validateTestInput").html("Input field is required").addClass(".validateTestInput")
                 return ;
                }else{
                	
                	 $(".validateTestInput").html("").removeClass(".validateTestInput")
                } 
         	 if (!$('.testCaseOutput').val()) {
                 $(".validateTestOutput").html("output field is required").addClass(".validateTestOutput")
                 return ;
                }else{
                	
                	 $(".validateTestOutput").html("").removeClass(".validateTestOutput")
                } 
        	}
        else
        	{
        	$(".validateTestInput").html("").removeClass(".validateTestInput")
        	$("#validateTestInputOut").html("").removeClass("#validateTestInputOut")
        	$(".validateTestOutput").html("").removeClass(".validateTestOutput")
        	}
	
            SampleTestCaseList.push(sampleTestCase);
            console.log(SampleTestCaseList);
          
            
            var Question = {
            	"questionId":updatedQuestionId,            
                "contestLevel": $(".contestlevel").val()+"@"+$(".contestid").val(),
                "question": $(".aboutQuestion").val(),
                "sampleTestCase": SampleTestCaseList,
                "testcases": testCaseList
            }; 
            if(updatedQuestionId==""){
            	console.log("updatedQuestionId blank",updatedQuestionId);
            	   $.ajax({
                       url: "/savequestion",
                       contentType: "application/json; charset=utf-8",
                       dataType: "json",
                       method: "POST",
                       data: JSON.stringify(Question),
                       success: function (response) {
                           console.log(response);
                           var data = '';
                               window.location.href = "questionlistforspecificcontest";
                       },
                       error: function (error) {
                       	 window.location.href = "questionlistforspecificcontest";
                           console.log(error);
                       },
                   });
            }
            else{  
            	console.log("updatedQuestionId fill ",updatedQuestionId);
            	 $.ajax({
                     url: "/saveupdatedquestion",
                     contentType: "application/json; charset=utf-8",
                     dataType: "json",
                     method: "POST",
                     data: JSON.stringify(Question),
                     success: function (response) {
                         console.log(response);
                         var data = '';
                             window.location.href = "questionlistforspecificcontest";
                     },
                     error: function (error) {
                     	 window.location.href = "questionlistforspecificcontest";
                         console.log(error);
                     },
                 });            
            }
      
    
            $(".aboutQuestion").val(''); 
            $(".aboutConstraints").val(''); 
            $(".aboutSampleInput").val(''); 
            $(".aboutSampleOutput").val('');
            $('.inputOutputList').remove();
        });
       
       
       
        function removeCurrentIOli(temp) {
            $("#" + temp).closest("li").remove();
        }
   
        function deleteQuestion(divId) {  
        	console.log("===>",divId);
        	var qIdAndContestId = []; 
        	
        	qIdAndContestId.push($(".contestid").val());
        	qIdAndContestId.push(divId);
        	qIdAndContestId.push($("#contestLevel").val());
        	var qid=divId;
        	var pDoc = document.getElementById(divId);
        	pDoc.parentNode.remove();
        	 $.ajax({
                 url: "/deletequestion",
                 contentType: "application/json; charset=utf-8",
                 dataType: "json",
                 method: "POST",
                 data: JSON.stringify(qIdAndContestId),
                 success: function (response) {
                    
                 },
                 error: function (error) {
                     console.log(error);
                 },

             });
        }

 $(".Edit_Question").on("click", function () {
	// $(".removeCurrentIOli1").remove();
	//console.log($(this).closest("div").find("#hiddenQid").val());
	 var qid=$(this).closest("div").find("#hiddenQid").val();
	 console.log("===>",qid);
	 
	 $.ajax({
         url: "/getsavedquestion",
         contentType: "application/json; charset=utf-8",
         dataType: "json",
         method: "POST",
         data: JSON.stringify(qid),
         success: function (response) {
        	updatedQuestionId = response.questionId.valueOf();
            console.log("Q1. ",response.question);
            var t=response.question;           
            console.log("Q2. ",t);                         
            document.getElementById("aboutQuestiondata").value = response.question.valueOf();
            document.getElementById("aboutConstraints").value = response.question.valueOf();
            t=response.sampleTestCase.valueOf();
            t.forEach(element => {  
            document.getElementById("aboutConstraints").value = element.constraints.valueOf();
            document.getElementById("aboutSampleInput").value = element.input.valueOf();
            document.getElementById("aboutSampleOutput").value = element.output.valueOf();
            });
            	 
            t=response.testcases.valueOf();
            t.forEach(element => {
            	var data = '<li class="removeCurrentIOli1 listStyle">';
                data += '<textarea class="form-control textarea_1 bg-white mx-3" id="input" name="dataOfIO">' + element.input.valueOf() + '</textarea><textarea class="form-control textarea_1 bg-white" id="output" name="dataOfIO">' + element.output.valueOf() + '</textarea> <div class="btn_img_cross" id="' + response.questionId.valueOf() + '" onclick="removeCurrentIOli(this.id)" ><img src="images/crossbtn.svg" class=" mx-3 mt-2" alt="cross" height="20px" width="20px" /></div></li>';          
                $('.inputOutputList').append(data);
            });
            
         },
         error: function (error) {
             console.log(error);
         },

     });
	
 })
 
  $('.form-select').change(function(){
        	
			var level = $(".form-select").val();
			console.log("level",level);
		
			console.log(level);
			 $.ajax({
                 url: "/filteravailablequebasedonlevel",
                 contentType: "application/json; charset=utf-8",
                 dataType: "json",
                 method: "POST",
                 data: JSON.stringify(level),
                 success: function (response) {
                	
                	 console.log(response);
                	 
                	  //**************************************
                	  
                    $(".availableglass").remove();
                     var  t = response.valueOf();
                    t.forEach(element => {
                    	var data="";
                      data += '<div class="availableglass"><div class="' + element.questionId.valueOf() +'"><div class="added_question_box row mx-4 mt-3"><div class="col-9"><p class="overflow_level1 "><span class="" style="overflow-wrap: anywhere;"> ' +element.question.valueOf()+ ' </span></p></div><div class="col-2 "><div><div class=" pt-3 mx-5"><div class="round"><input type="checkbox" id="' + element.questionId.valueOf() +'" name="color" value="' + element.questionId.valueOf() +'" /> <label for="' + element.questionId.valueOf() +'"></label></div></div></div></div> <div class="col-1 mt-3 btn_img_cross" id="' + element.questionId.valueOf() +'" onclick="deleteQuestion(this.id)"> </div></div></div></div> '
                    	  $('.added_questions_all_question').append(data);
                    });
                    
                      //*******************************************
                	 
                	
                 },
                 error: function (error) {  
                	console.log(error);
                 },
                
             });
			 
			 sessionStorage.setItem("form-select", $(this).val());
		
        });
 
        function all_question_div7() {
            var x = document.getElementById("all_question_div7");
            sessionStorage.setItem("form-select", "All");
            if (x.style.display === "block") {
                x.style.display = "none";
            } else {
                x.style.display = "block";
            }
           
        }


        const btn = document.querySelector('#btn');
        btn.addEventListener('click', (event) => {
            let checkboxes = document.querySelectorAll('input[name="color"]:checked');
            console.log("checkboxes",checkboxes);
            let values = [];
            values.push($(".contestid").val());
            checkboxes.forEach((checkbox) => {
                values.push(checkbox.value);
            });
            $.ajax({
                url: "/addselectedavailablequetocontest",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                method: "POST",
                data: JSON.stringify(values),
                success: function (response) {  
                	
                	//***************
                	var  t = response.valueOf();
                    t.forEach(element => {
                    	console.log("t => ",element);
                    	var data="";
                	data += '<div> <div class="' + element.questionId.valueOf() +'"> <div class="added_question_box row mx-4 mt-3"> <div class="col-8"> <p class="added_question_box_text"> <span class="added_question_box_text" > ' +element.question.valueOf()+ ' </span> </p> </div> <div class="col-3 "> <input type="hidden" id="hiddenQid" class="questionid" value="' + element.questionId.valueOf() +'"></input><p class="Edit_Question  mx-5">Edit Question</p> </div> <div class="col-1 mt-3 btn_img_cross" id="' + element.questionId.valueOf() +'" onclick="deleteQuestion(this.id)"> <img src="images/crossbtn.svg" alt="logo" /> </div> </div> </div> </div>'									
					$('.added_questions').append(data);
                    });
                	//***************
                	
                	
                	
                	
                	
                },
                error: function (error) {
                    console.log(error);
                },

            });
            console.log(values);
        });
        $('#file-class').change(function (e){	
            debugger;
             var file = $("#file-class")[0].files[0]; 

             e.preventDefault();
             var myformData = new FormData();
             myformData.append('file',file);
             myformData.append('level',"Level 1");
       	 $.ajax({
               url: "/question/upload",
               method: 'POST',
               processData: false,
               contentType: false,
               cache: false,
               data: myformData ,
               enctype: 'multipart/form-data',
         
               success: function (response) {	
              	 console.log(response);
              	 window.location.href = "questionuploaded";
              	
               },
               error: function (error) {  
              	console.log(error);
               },
              
           });

       });

     //]]>
    </script>
</body>

</html>